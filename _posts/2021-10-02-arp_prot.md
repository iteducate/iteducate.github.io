---
layout: single
title:  "Структура протокола ARP"
date:   2021-10-02 09:00:00 +0300
tags: protocols arp 
categories: networks
comments: true

layouts_gallery_1:
  - url: /assets/images/arp/process.png
    image_path: /assets/images/arp/process.png

layouts_gallery_2:
  - url: /assets/images/arp/arp_request.png
    image_path: /assets/images/arp/arp_request.png

layouts_gallery_3:
  - url: /assets/images/arp/arp_reply.png
    image_path: /assets/images/arp/arp_reply.png

---

Маршрутизаторы передают пакеты по какому-либо логическому пути, который состоит из определённого количества каналов передачи данных, *"читая" и "взаимодействуя"* с сетевыми адресами. Пакеты, инкапсулированные в кадры (фреймы), передаются через канальную среду. Фреймы содержат уникальные идентификаторы канальной среды (*например, MAC-адреса*) для определения адресата источника и назначения в канальной среде.

Устройствам в канальной среде необходим способ определения идентификаторов канальной среды соседей для того чтобы фреймы могли быть отправлены корректному адресату назначения. Одним из таких механизмов определения для протокола [IP версии 4](/networks/ip_prot/) является протокол ARP - Address Resolution Protocol, описанный в [RFC 826](https://www.rfc-editor.org/rfc/rfc826.html).

На рисунке 1 изображён процесс работы протокола ARP

{% include gallery id="layouts_gallery_1" caption="**Процесс работы протокола ARP**" %}

Устройство, которому необходимо узнать идентификатор канальной среды другого устройства, создает пакет **ARP Request**. Данный запрос содержит в себе IP-адрес устройства для которого необходимо узнать идентификатор канального среды (`Target`), а также данные канальной среды (*в данном случае MAC-адрес*) и IP-адрес устройства, которое данный запрос сформировало (`Source`). 

Пакет ARP Request инкапсулируется в фрейм. В качестве MAC-адреса источника выступает сам источник, в качестве MAC-адреса назначения используется broadcast адрес (`FFFF.FFFF.FFFF`).

Вот как выглядит ARP Request если захватить его с помощью wireshark

{% include gallery id="layouts_gallery_2" caption="**ARP Request**" %}

Подробно рассмотреть каждое поле запроса ARP можно скачав данный [дамп](/assets/pcap/arp_request.pcapng)

Broadcast адрес используется для того чтобы все узлы в канальной среде получили данный фрейм и обработали инкапсулированный внутри пакет. Все устройства, за исключением адресата назначения, поймут, что данный пакет не предназначается для них и попросту отбросят его. Устройство назначения обработает пакет и в ответ отправит **ARP Reply** адресату источника. Внутри ARP Reply будет содержаться как раз-таки MAC-адрес адресата назначения.

На следующем изображении можно увидеть как выглядит ARP Reply

{% include gallery id="layouts_gallery_3" caption="**ARP Reply**" %}

Также скачав [дамп с трафиком](/assets/pcap/arp_reply.pcapng) можно более подробно увидеть каждое поле пакета

**P.S.** *вся информация представленная здесь используется исключительно в образовательных целях. Все совпадения с реальными объектами, адресами, именами и т.д. случайна и не несёт цели получить от этого выгоду или причинить кому-либо вред.*