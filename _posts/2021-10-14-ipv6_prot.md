---
layout: single
title:  "Структура протокола IPv6"
date:   2021-10-14 09:00:00 +0300
tags: protocols ipv6 
categories: networks
comments: true
toc: true
toc_label: "Содержание"
toc_sticky: true

layouts_gallery_1:
  - url: /assets/images/ipv6/global_unicast.png
    image_path: /assets/images/ipv6/global_unicast.png

layouts_gallery_2:
  - url: /assets/images/ipv6/unique_local.png
    image_path: /assets/images/ipv6/unique_local.png

layouts_gallery_3:
  - url: /assets/images/ipv6/link_local.png
    image_path: /assets/images/ipv6/link_local.png

layouts_gallery_4:
  - url: /assets/images/ipv6/anycast.png
    image_path: /assets/images/ipv6/anycast.png
---

Протокол IPv6 пришел на замену протоколу IPv4 и хотя в настоящее время IPv4 всё еще везде используется, придет время и протокол IPv6 вытеснит своего предшественника полностью.

Первое, что стоит упомянуть когда рассматривают протокол IPv6 - это измененная структура адреса и количество возможных адресов. Если в IPv4 используется `2^32` адресов, то в новой версии это число достигает невероятных значений `2^128`. Структура адреса выглядит следующим образом: `2001:1536:a0b8:3491:c800:00ef:fe74:0c00` - 8 хекстетов, разделенных символом `:`

## Типы адресов IPv6

Всего существует три основных типа IPv6 адресов:

* **Unicast** адреса
* **Anycast** адреса
* **Multicast** адреса

В отличие от IPv4, в IPv6 нет broadcast адресов. Однако, группа multicast адресов *"all nodes"* делает ту же работу, что и broadcast адреса.

### Unicast

IPv6 unicast адреса работают в точности так же как и в IPv4. Данные адреса определяют один интерфейс или устройство. Существует три типа IPv6 unicast адресов:

* **Global** адреса - это те же адреса, что и публичные адреса в IPv4. Они глобально маршрутизируются и могут использоваться при коммуникации через сеть Интернет. В настоящее время вся глобальная одноадресная адресация выделяется из префиксного блока `2000::/3`.
  {% include gallery id="layouts_gallery_1" caption="**Global scope**" %}
* **Unique local unicast** адреса - адреса, которые в IPv4 определены как *"серые"*, т.е. адреса, описанные в [RFC 1918](https://www.rfc-editor.org/rfc/rfc1918.html). Данные адреса маршрутизируются в пределах внутренней коммуникации организации и не маршрутизируются в сети Интернет. [RFC 4193](https://www.rfc-editor.org/rfc/rfc4193.html) определяет блок префиксов `fc00::/7` для уникальной локальной одноадресной адресации. Данные адреса всегда начинаются с двоичного значения `1111 110`, которое соответствует префиксу `fc00::/7`. Восьмой бит - `бит L` в настоящее время установлен в 1, чтобы указать, что адрес назначен локально. Установка бита L на 0 еще не определена и зарезервирована для использования в будущем. Объединение префикса (*первых 7 бит*) и бита L создает два потенциальных адресных блока:
  * `fc00::/8`: зарезервировано для будущего использования
  * `fd00::/8`: локальная одноадресная адресация
  {% include gallery id="layouts_gallery_2" caption="**Unique local scope**" %}
* **Link-local** адреса - немаршрутизируемые адреса, используются для коммуникации в пределах одного непосредственно подключенного канала. Основное назначение данных адресов - обнаружение соседей и определение дубликата адресов. Адреса выделяются из префиксного блока `fe80::/10`. Данные адреса могут назначаться как вручную, так и динамически с использованием механизма **SLAAC** (*stateless address autoconfiguration*). При использовании SLAAC часть Interface ID выводится из MAC-адреса модификацией формата EUI-64.
  {% include gallery id="layouts_gallery_3" caption="**Link local scope**" %}

### Anycast

Anycast адреса представляют скорее сервис нежели чем отдельное устройство, поэтому один адрес может быть назначен разным устройствам, предоставляющим один и тот же сервис. Основное предназначение anycast адресов - обеспечение отказоустойчивости.

На следующей схеме приведён пример того как может выглядеть это в реальности

{% include gallery id="layouts_gallery_4" caption="**Anycast**" %}

В сети имеется два сервера, которые имеют идентичную адресацию, но физически расположены в разных местах. В зависимости от того где находится клиент, трафик пойдет к ближайшему серверу, опираясь на таблицу маршрутизации. 

В случае если в сети произойдет падение одного из маршрутизаторов, находящихся рядом с серверами, произойдет перестроение пути следования трафика для одного из клиентов и трафик для этого клиента пойдет по новому пути. В этом случае оба клиента будут обращаться к одному и тому же серверу.

Какого определённого формата для данных типов адресов не существует, поэтому теоретически любой unicast адрес может быть anycast. Для корректной работы anycast адресов может быть желательно отключать механизм определения дубликата адресов (*DAD - Duplicate Address Detection*). В операционной системе Cisco IOS и Cisco IOS XE механизм DAD отключается для всего префикса, делается это следующей командой:

{% highlight console linenos %}
Cisco_CSR1000v(config)# interface gigabitEthernet 1
Cisco_CSR1000v(config-if)# ipv6 address 2001:abcd:1111::1/64 anycast 
{% endhighlight %}

Для операционной системы Cisco IOS XR механизм DAD отключается для всего интерфейса (*включая префиксы link-local*) с помощью команды:

{% highlight console linenos %}
RP/0/0/CPU0:Cisco_XRv(config)# interface gigabitEthernet 0/0/0/0
RP/0/0/CPU0:Cisco_XRv(config-if)# ipv6 nd dad attempts 0
{% endhighlight %}


### Multicast
**P.S.** *вся информация представленная здесь используется исключительно в образовательных целях. Все совпадения с реальными объектами, адресами, именами и т.д. случайна и не несёт цели получить от этого выгоду или причинить кому-либо вред.*